<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record model="ir.rule" id="sale.sale_order_comp_rule">
        <field name="name">Sales Order multi-company</field>
        <field name="model_id" ref="model_sale_order"/>
        <field name="domain_force">['|',('company_id', 'in', company_ids),('cust_user_id','=',user.id)]</field>
    </record>

    <record id="view_order_form_inherit" model="ir.ui.view">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="/form/sheet//field[@name='payment_term_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='user_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='team_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='require_signature']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='require_payment']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='client_order_ref']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='tag_ids']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='fiscal_position_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='payment_term_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='origin']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='campaign_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='medium_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='source_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='signed_by']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='signed_on']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>
            <xpath expr="/form/sheet//field[@name='signature']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel'))]}</attribute>
            </xpath>

            <xpath expr="/form/sheet//field[@name='payment_term_id']" position="after">
                <field name="deliverable" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"/>
<!--                <field name="project_template"/>-->
                <field name="cust_user_id" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"/>
            </xpath>
            <xpath expr="/form//field[@name='partner_id']" position="after">
                <field name="so_desc" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"/>
                <field name="po_desc" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"/>
<!--                <field name="project_type" />-->
<!--                <field name="project_type_code" invisible="1"/>-->
                <field name="pan_no" invisible="1"/>
                <field name="msme" invisible="1"/>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='name']" position="after">
                <field name="department_id"/>
            </xpath>
            <xpath expr="/form//page[@name='other_information']" position="after">
                <page name="sales_milestone" string="Milestones">
                    <field name="sale_milestone" nolabel="1" widget="one2many" width="10px" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}">
                        <tree editable="bottom" no_create="True">
                            <field name="seq"/>
                            <field name="milestone_perc" widget="percentage"/>
                            <field name="description"/>
                        </tree>
                    </field>
                    <group col="6" class="mt-2 mt-md-0">
                        <group colspan="3">
                            <label for="tot_per" name="Total Milestone:"/>
                            <b><field name="tot_per" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"/></b>

                            <label for="amount_to_pay" name="Milestone based amount"/>
                            <b><field name="amount_to_pay" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"/></b>
                        </group>
                        <group/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <record id="view_sale_order_search_inherited" model="ir.ui.view">
        <field name="name">sale.search.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="pan_no"/>
                <field name="msme"/>
            </xpath>
        </field>
    </record>
</odoo>